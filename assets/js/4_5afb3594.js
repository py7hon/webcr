(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{382:function(t,e,i){"use strict";i.r(e);i(28),i(38),i(39),i(40),i(41),i(42),i(43),i(44),i(15),i(37),i(378);var n={name:"collection",components:{MediaCard:i(405).a},props:{collection:Object,open:Boolean}},a=i(2),s=Object(a.a)(n,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"mb-2"},[i("button",{staticClass:"btn btn-block btn-secondary text-left",attrs:{type:"button","data-toggle":"collapse","data-target":"#collection-"+t.collection.id,"aria-expanded":"false","aria-controls":"collection-"+t.collection.id}},[t._v("\n    "+t._s(t.collection.name)+"\n    "),i("span",{staticClass:"dropdown-toggle float-right"})]),t._v(" "),i("div",{class:"row collapse mt-2"+(t.open?" show":""),attrs:{id:"collection-"+t.collection.id}},t._l(t.collection.media,(function(t){return i("div",{key:t.media_id,staticClass:"col-lg-3 col-md-4 col-sm-6 offset-sm-0 col-8 offset-2 mb-4"},[i("media-card",{attrs:{media:t}})],1)})),0)])}),[],!1,null,null,null).exports,r=i(395),o=i(421),c=(i(377),{name:"series-watched-loading-modal",components:{ProgressBar:i(404).a},props:{completion:Number,currentEpisode:String}}),d=Object(a.a)(c,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal",attrs:{role:"dialog"}},[e("div",{staticClass:"modal-dialog modal-dialog-centered",attrs:{role:"document"}},[e("div",{staticClass:"modal-content bg-dark text-light"},[e("div",{staticClass:"modal-body text-center"},[e("progress-bar",{attrs:{value:this.completion}}),this._v("\n        "+this._s(this.currentEpisode)+"\n      ")],1)])])])}),[],!1,null,null,null).exports,u=i(314),l=i.n(u);function m(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,o=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,s=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw s}}}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var f={name:"toggle-series-watched-button",props:{mediaList:Array},computed:{watched:function(){var t,e=m(this.mediaList);try{for(e.s();!(t=e.n()).done;){var i=t.value;if(!this.hasWatched(i))return!1}}catch(t){e.e(t)}finally{e.f()}return!0},completion:function(){return(this.index+1)/this.mediaList.length*100},currentEpisode:function(){if(-1===this.index||this.index>=this.mediaList.length)return"";var t=this.mediaList[this.index];return"".concat(this.$t("media.episode",{number:t.episode_number}),": ").concat(t.name," - ").concat(t.collection_name)}},components:{LoadingModal:d},methods:{toggle:function(){l()("#loadingModal").modal({keyboard:!1,backdrop:!0}),this.index=-1,this.mark(!this.watched)},hasWatched:function(t){return t.playhead>=.9*t.duration},mark:function(t){var e=this;if(this.index++,this.index>=this.mediaList.length)return l()("#loadingModal").modal("hide"),this.$emit("complete"),void(this.index=-1);this.hasWatched(this.mediaList[this.index])!==t?this.$store.dispatch("media/setWatched",{mediaId:this.mediaList[this.index].media_id,watched:t,duration:this.mediaList[this.index].duration}).then((function(){e.mark(t)})):this.mark(t)}},data:function(){return{index:-1}}},g=Object(a.a)(f,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span",[i("button",{staticClass:"btn btn-primary btn-sm",on:{click:t.toggle}},[t._v(t._s(t.watched?t.$t("media.markUnwatched"):t.$t("media.markWatched")))]),t._v(" "),i("loading-modal",{attrs:{id:"loadingModal",completion:t.completion,currentEpisode:t.currentEpisode}})],1)}),[],!1,null,null,null).exports,p={name:"rating",props:{rating:Number}},v=(i(443),Object(a.a)(p,(function(){var t=this.$createElement;return(this._self._c||t)("span",{class:"rating rating-"+this.rating},[this._v("★★★★★")])}),[],!1,null,"598981e7",null).exports);function b(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return _(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return _(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,r=!0,o=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return r=t.done,t},e:function(t){o=!0,s=t},f:function(){try{r||null==i.return||i.return()}finally{if(o)throw s}}}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}var x={name:"series",mounted:function(){this.$store.dispatch("media/getSeries",this.seriesId)},data:function(){return{collectionsLoading:!1}},computed:{series:function(){return this.$store.state.media.currentSeries},kitsuPage:function(){return this.$store.state.media.currentSeriesKitsuPage},mediaCollections:function(){var t,e=[],i=b(this.$store.state.media.mediaList);try{var n=function(){var i=t.value;if(!e.find((function(t){return t.id===i.collection_id}))){var n={};n.id=i.collection_id,n.name=i.collection_name,n.media=[],e.push(n)}e.find((function(t){return t.id===i.collection_id})).media.push(i)};for(i.s();!(t=i.n()).done;)n()}catch(t){i.e(t)}finally{i.f()}return e},seriesId:function(){return this.$route.params.id},locale:function(){return this.$store.state.locale.locale},mediaList:function(){return this.$store.state.media.mediaList}},components:{Collection:s,Loading:r.a,ToggleQueueButton:o.a,ToggleWatchedButton:g,Rating:v},watch:{series:function(t){var e=this;this.collectionsLoading=!0,this.$store.dispatch("media/listMedia",{seriesId:this.seriesId,count:this.series.media_count}).then((function(){e.collectionsLoading=!1})),document.title="".concat(this.series.name," ― CR")},seriesId:function(){this.$store.dispatch("media/getSeries",this.seriesId)},locale:function(){this.$store.dispatch("media/getSeries",this.seriesId)}},methods:{onQueueToggle:function(t){this.$store.dispatch("media/getSeries",this.seriesId).then((function(){t()}))},onWatchedToggle:function(){var t=this;this.collectionsLoading=!0,this.$store.dispatch("media/listMedia",{seriesId:this.seriesId,count:this.series.media_count}).then((function(){t.collectionsLoading=!1}))}}},y=(i(444),Object(a.a)(x,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.series&&t.series.series_id==t.seriesId?i("div",[i("div",{staticClass:"header mb-3"},[i("div",{staticClass:"header-image",style:{"background-image":"url('"+t.$https(t.series.landscape_image.full_url)+"')"}}),t._v(" "),i("div",{staticClass:"header-gradient"},[i("div",{staticClass:"container"},[i("div",{staticClass:"row"},[i("h2",{staticClass:"text-light col-9"},[t._v(t._s(t.series.name))])])])])]),t._v(" "),i("div",{staticClass:"container"},[i("div",{staticClass:"row mb-3"},[i("div",{staticClass:"col-md-9 col-12 info-block"},[i("p",{staticClass:"text-light"},[t._v(t._s(t.series.description))]),t._v(" "),i("div",{staticClass:"mb-2"},t._l(t.series.genres,(function(e){return i("router-link",{key:e,staticClass:"btn btn-secondary btn-sm mr-1",attrs:{to:"/browse/categories/"+t.series.media_type+"/"+e}},[t._v(t._s(e))])})),1),t._v(" "),i("toggle-queue-button",{attrs:{seriesId:t.series.series_id,inQueue:t.series.in_queue},on:{toggle:t.onQueueToggle}}),t._v(" "),i("toggle-watched-button",{attrs:{mediaList:t.mediaList},on:{complete:t.onWatchedToggle}}),t._v(" "),i("span",{staticClass:"float-right"},[t.kitsuPage?i("a",{staticClass:"kitsu-link",attrs:{href:t.kitsuPage,target:"_blank"}}):t._e(),t._v(" "),i("rating",{attrs:{rating:t.series.rating}})],1)],1),t._v(" "),i("div",{staticClass:"col-3 d-none d-md-block"},[t.series.portrait_image?i("img",{staticClass:"img-fluid mx-auto d-block box-image",attrs:{src:t.$https(t.series.portrait_image.large_url)}}):t._e()])]),t._v(" "),t.collectionsLoading?i("loading"):i("div",t._l(t.mediaCollections,(function(t,e){return i("collection",{key:t.id,attrs:{collection:t,open:0==e}})})),1)],1)]):i("loading")}),[],!1,null,"7859d072",null));e.default=y.exports},395:function(t,e,i){"use strict";var n={name:"loading",data:function(){return{count:5}}},a=(i(398),i(2)),s=Object(a.a)(n,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"spinner"},this._l(this.count,(function(t){return e("div",{key:t,class:"rect rect"+t})})),0)}),[],!1,null,"597d1897",null);e.a=s.exports},396:function(t,e,i){},397:function(t,e,i){},398:function(t,e,i){"use strict";i(396)},399:function(t,e,i){"use strict";var n={name:"card"},a=(i(400),i(2)),s=Object(a.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"card bg-dark text-light"},[this._t("default")],2)}),[],!1,null,"2edc5dc4",null);e.a=s.exports},400:function(t,e,i){"use strict";i(397)},401:function(t,e,i){},402:function(t,e,i){"use strict";var n=i(1);e.a=new n.a},403:function(t,e,i){},404:function(t,e,i){"use strict";i(377);var n={name:"progress-bar",props:{value:Number}},a=i(2),s=Object(a.a)(n,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"progress rounded-0 bg-warning",staticStyle:{height:"4px"}},[e("div",{staticClass:"progress-bar bg-primary",style:{width:this.value+"%"},attrs:{role:"progressbar","aria-valuenow":this.value,"aria-valuemin":"0","aria-valuemax":"100"}})])}),[],!1,null,null,null);e.a=s.exports},405:function(t,e,i){"use strict";i(380),i(311);var n=i(404),a=i(399),s=(i(20),i(15),i(21),i(378),i(377),i(1)),r=i(379),o=i.n(r);function c(t,e,i,n,a,s,r){try{var o=t[s](r),c=o.value}catch(t){return void i(t)}o.done?e(c):Promise.resolve(c).then(n,a)}function d(t){return function(){var e=this,i=arguments;return new Promise((function(n,a){var s=t.apply(e,i);function r(t){c(s,n,a,r,o,"next",t)}function o(t){c(s,n,a,r,o,"throw",t)}r(void 0)}))}}s.a.use(o.a);var u={name:"media-card-context",props:{value:Boolean,position:{x:Number,y:Number},mediaId:String,seriesId:String,watched:Boolean,duration:Number},computed:{inQueue:function(){var t=this;return void 0!==this.$store.state.queue.queue.find((function(e){return e.series.series_id===t.seriesId}))}},methods:{close:function(){this.$emit("input",!1)},toggleWatched:function(){var t=this;return d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.close(),t.$emit("beginUpdate"),e.next=4,t.$store.dispatch("media/setWatched",{mediaId:t.mediaId,watched:!t.watched,duration:t.duration});case 4:return e.next=6,t.$store.dispatch("media/updateMedia",t.mediaId);case 6:t.$emit("updated");case 7:case"end":return e.stop()}}),e)})))()},toggleQueue:function(){var t=this;return d(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.close(),t.$emit("beginUpdate"),e.next=4,t.$store.dispatch("media/toggleQueue",{seriesId:t.seriesId,inQueue:t.inQueue});case 4:return e.next=6,t.$store.dispatch("media/updateSeries",t.seriesId);case 6:return e.next=8,t.$store.dispatch("queue/getQueue");case 8:t.$emit("updated");case 9:case"end":return e.stop()}}),e)})))()}}},l=(i(406),i(2)),m=Object(l.a)(u,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.value?i("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.close,expression:"close"}],staticClass:"list-group position-absolute text-nowrap",style:{left:t.position.x+"px",top:t.position.y+"px"}},[i("a",{staticClass:"list-group-item list-group-item-action bg-dark text-light",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.toggleWatched(e)}}},[t._v("\n    "+t._s(t.watched?t.$t("media.markUnwatched"):t.$t("media.markWatched"))+"\n  ")]),t._v(" "),i("a",{staticClass:"list-group-item list-group-item-action bg-dark text-light",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.toggleQueue(e)}}},[t._v("\n    "+t._s(t.inQueue?t.$t("media.queueRemove"):t.$t("media.queueAdd"))+"\n  ")])]):t._e()}),[],!1,null,"3b8ea60a",null).exports,h=i(395),f=i(402),g={name:"media-card",props:{media:Object,active:Boolean},data:function(){return{showContextMenu:!1,contextMenuPosition:{x:0,y:0},loading:!1,cardHeight:0}},components:{ProgressBar:n.a,Card:a.a,MediaCardContext:m,Loading:h.a},created:function(){var t=this;f.a.$on("closeContextMenus",(function(){t.showContextMenu=!1}))},methods:{contextMenu:function(t){f.a.$emit("closeContextMenus"),this.showContextMenu=!0,this.contextMenuPosition.x=t.clientX-this.$refs.card.$el.getBoundingClientRect().left,this.contextMenuPosition.y=t.clientY-this.$refs.card.$el.getBoundingClientRect().top},mediaUpdated:function(){this.loading=!1},mediaBeginUpdate:function(){this.cardHeight=this.$refs.card.$el.getBoundingClientRect().height,this.loading=!0}},computed:{length:function(){return new Date(1e3*this.media.duration).toISOString().substr(11,8).replace(/^(00:)?0?/,"")},watchedTime:function(){return new Date(1e3*this.media.playhead).toISOString().substr(11,8).replace(/^(00:)?0?/,"")},watched:function(){return this.media.playhead>=.9*this.media.duration}}},p=(i(407),Object(l.a)(g,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t.loading?i("card",{class:{"active-card":t.active},style:{height:t.cardHeight+"px"}},[i("loading",{staticClass:"my-auto"})],1):i("card",{ref:"card",class:{"active-card":t.active},nativeOn:{contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.contextMenu(e)}}},[i("router-link",{staticClass:"text-reset embed-responsive embed-responsive-16by9",attrs:{to:"/media/"+t.media.media_id}},[t.media.screenshot_image?i("img",{staticClass:"card-img-top embed-responsive-item image",attrs:{src:t.$https(t.media.screenshot_image.large_url),alt:"Media Thumbnail"}}):t._e(),t._v(" "),i("div",{staticClass:"play"}),t._v(" "),t.watched?i("div",{staticClass:"watched-grey"}):t._e(),t._v(" "),t.watched?i("fa-icon",{staticClass:"watched",attrs:{icon:"eye"}}):t._e(),t._v(" "),i("span",{staticClass:"badge badge-secondary length"},[t._v(t._s(t.media.playhead>0&&!t.watched?t.watchedTime+" / ":"")+t._s(t.length))])],1),t._v(" "),i("progress-bar",{attrs:{value:t.media.playhead/t.media.duration*100}}),t._v(" "),i("div",{staticClass:"mx-2 my-1 d-flex flex-column"},[i("span",{staticClass:"text-truncate"},[i("router-link",{staticClass:"text-reset",attrs:{to:"/series/"+t.media.series_id,title:t.media.collection_name}},[t._v("\n          "+t._s(t.media.collection_name)+"\n        ")])],1),t._v(" "),i("small",{staticClass:"text-truncate"},[i("router-link",{staticClass:"text-reset",attrs:{to:"/media/"+t.media.media_id,title:t.$t("media.episode",{number:t.media.episode_number})+" ― "+t.media.name}},[t._v("\n          "+t._s(t.$t("media.episode",{number:t.media.episode_number}))+" ― "+t._s(t.media.name)+"\n        ")])],1)]),t._v(" "),t._t("default")],2),t._v(" "),i("media-card-context",{attrs:{position:t.contextMenuPosition,watched:t.watched,mediaId:t.media.media_id,seriesId:t.media.series_id,duration:t.media.duration},on:{beginUpdate:t.mediaBeginUpdate,updated:t.mediaUpdated},model:{value:t.showContextMenu,callback:function(e){t.showContextMenu=e},expression:"showContextMenu"}})],1)}),[],!1,null,"e63b62fa",null));e.a=p.exports},406:function(t,e,i){"use strict";i(401)},407:function(t,e,i){"use strict";i(403)},421:function(t,e,i){"use strict";var n=i(395),a={name:"toggle-queue-button",props:{seriesId:String,inQueue:Boolean},data:function(){return{loading:!1}},methods:{toggleQueue:function(){var t=this;this.loading=!0,this.$store.dispatch("media/toggleQueue",{seriesId:this.seriesId,inQueue:this.inQueue}).then((function(){t.$emit("toggle",t.endLoading)}))},endLoading:function(){this.loading=!1}},components:{Loading:n.a}},s=i(2),r=Object(s.a)(a,(function(){var t=this.$createElement,e=this._self._c||t;return this.loading?e("button",{staticClass:"btn btn-disabled btn-sm"},[e("loading")],1):e("button",{staticClass:"btn btn-primary btn-sm",on:{click:this.toggleQueue}},[this._v(this._s(this.inQueue?this.$t("media.queueRemove"):this.$t("media.queueAdd")))])}),[],!1,null,null,null);e.a=r.exports},430:function(t,e,i){},431:function(t,e,i){},443:function(t,e,i){"use strict";i(430)},444:function(t,e,i){"use strict";i(431)}}]);